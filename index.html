 # 导入所需的库
import newspaper
import PyPDF2
import spacy
import streamlit as st

# 定义一个函数，用于从网页或PDF文件中提取文本
def extract_text(source):
    if source.startswith("http"):
        # 如果是网页，使用newspaper库解析
        article = newspaper.Article(source)
        article.download()
        article.parse()
        text = article.text
    else:
        # 如果是PDF文件，使用PyPDF2库读取
        pdf_file = open(source, "rb")
        pdf_reader = PyPDF2.PdfFileReader(pdf_file)
        num_pages = pdf_reader.numPages
        text = ""
        for i in range(num_pages):
            page = pdf_reader.getPage(i)
            text += page.extractText()
    return text

# 定义一个函数，用于对文本进行摘要
def summarize_text(text, ratio=0.2):
    # 使用spacy库加载预训练的模型
    nlp = spacy.load("en_core_web_sm")
    # 创建一个文档对象
    doc = nlp(text)
    # 使用textacy库提供的算法生成摘要
    summary = textacy.summarization.text_summarizer(doc, ratio=ratio)
    return summary.text

# 使用streamlit库创建一个简洁的网页界面
st.title("文本摘要工具")
st.write("这是一个可以帮助用户快速提取文本中的主要信息和观点的工具，可以应用于学习、研究、写作等场景。支持不同语言、不同长度、不同领域的文本摘要，以及提供摘要评分、关键词提取、参考文献生成等功能。")

# 让用户输入文本来源，可以是网页链接或PDF文件路径
source = st.text_input("请输入文本来源（网页链接或PDF文件路径）：")

# 让用户选择摘要比例，即摘要占原文的百分比
ratio = st.slider("请选择摘要比例（0-1）：", 0.0, 1.0, 0.2)

# 当用户点击“生成摘要”按钮时，执行以下操作
if st.button("生成摘要"):
    # 从文本来源提取文本
    text = extract_text(source)
    # 对文本进行摘要
    summary = summarize_text(text, ratio)
    # 在网页上显示原文和摘要，并计算摘要的评分（基于ROUGE指标）
    st.subheader("原文")
    st.write(text)
    st.subheader("摘要")
    st.write(summary)
    st.subheader("摘要评分")
    score = textacy.similarity.rouge(summary, text)
    st.write(score)

