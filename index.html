<html>
<head>
    <style>
        /* 设置页面背景颜色为浅灰色 */
        body {
            background-color: #f0f0f0;
        }

        /* 设置标题样式 */
        h1 {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 36px;
            color: #333333;
            text-align: center;
            margin-top: 50px;
        }

        /* 设置副标题样式 */
        h2 {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 24px;
            color: #666666;
            text-align: center;
            margin-top: 20px;
        }

        /* 设置文本框样式 */
        textarea {
            width: 600px;
            height: 200px;
            border: 2px solid #cccccc;
            border-radius: 10px;
            padding: 10px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 16px;
            color: #333333;
            resize: none;
        }

        /* 设置按钮样式 */
        button {
            width: 100px;
            height: 40px;
            border: none;
            border-radius: 10px;
            background-color: #3399ff;
            color: white;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 16px;
        }

        /* 设置摘要框样式 */
        div {
            width: 600px;
            height: auto;
            border: 2px solid #cccccc;
            border-radius: 10px;
            padding: 10px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 16px;
            color: #333333;
        }

        /* 设置居中布局 */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    </style>
</head>
<body>
    <h1>文本摘要工具 Text Summarizer</h1>
    <h2>快速提取文本中的主要信息和观点 Quickly extract the main information and opinions from the text</h2>
    <div class="container">
        <!-- 创建一个文本框用于输入原始文本 -->
        <textarea id="input" placeholder="请输入原始文本或粘贴网页链接 Please enter the original text or paste the web page link"></textarea>
        <!-- 创建一个按钮用于触发摘要生成 -->
        <button id="summarize" onclick="summarize()">生成摘要 Summarize</button>
        <!-- 创建一个摘要框用于显示摘要结果 -->
        <div id="output" hidden></div>
    </div>

    <script>
        // 定义一个函数用于生成摘要
        function summarize() {
            // 获取输入框的值
            var input = document.getElementById("input").value;

            // 判断输入是否为空
            if (input == "") {
                alert("请输入原始文本或粘贴网页链接 Please enter the original text or paste the web page link");
                return; // 结束函数
            }

            // 判断输入是否为网页链接
            if (input.startsWith("http")) {
                // 使用fetch函数获取网页内容
                fetch(input)
                    .then(response => response.text()) // 将响应转换为文本
                    .then(html => { // 处理文本
                        // 使用DOMParser对象解析HTML文本
                        var parser = new DOMParser();
                        var doc = parser.parseFromString(html, "text/html");

                        // 获取网页标题
                        var title = doc.querySelector("title").innerText;

                        // 获取网页正文
                        var body = doc.querySelector("body").innerText;

                        // 调用extract函数提取正文中的关键词和句子
                        var summary = extract(body);

                        // 显示摘要结果
                        showSummary(title, summary);
                    })
                    .catch(error => { // 处理错误
                        alert("无法获取网页内容 Cannot get the web page content");
                        console.log(error);
                    });
            } else {
                // 输入为原始文本，直接调用extract函数提取关键词和句子
                var summary = extract(input);

                // 显示摘要结果
                showSummary("原始文本 Original Text", summary);
            }
        }

        // 定义一个函数用于提取关键词和句子
        function extract(text) {
            // 定义一个对象用于存储摘要结果
            var summary = {
                keywords: [], // 关键词数组
                sentences: [] // 句子数组
            };

            // 定义一个正则表达式用于匹配中文和英文单词
            var wordRegex = /[\u4e00-\u9fa5a-zA-Z]+/g;

            // 定义一个正则表达式用于匹配中文和英文句子
            var sentenceRegex = /[\u4e00-\u9fa5a-zA-Z0-9,.?!，。？！]+/g;

            // 定义一个对象用于存储单词的出现次数
            var wordCount = {};

            // 定义一个变量用于存储总的单词数
            var totalWords = 0;

            // 使用正则表达式匹配所有的单词
            var words = text.match(wordRegex);

            // 遍历所有的单词
            for (var word of words) {
                // 将单词转换为小写
                word = word.toLowerCase();

                // 如果单词已经在对象中，增加其出现次数
                if (word in wordCount) {
                    wordCount[word]++;
                } else {
                    // 否则，将单词添加到对象中，初始化其出现次数为1
                    wordCount[word] = 1;
                }

                // 增加总的单词数
                totalWords++;
            }

            // 定义一个数组用于存储按照出现次数排序的单词
            var sortedWords = [];

            // 遍历对象中的所有键值对
            for (var [word, count] of Object.entries(wordCount)) {
                // 将键值对作为一个数组添加到排序数组中
                sortedWords.push([word, count]);
            }

            // 使用sort函数对排序数组进行降序排序，根据出现次数比较大小
            sortedWords.sort((a, b) => b[1] - a[1]);

            // 定义一个变量用于存储关键词的个数，根据总的单词数确定，最多为10个
            var keywordNum = Math.min(Math.floor(totalWords / 10), 10);

            // 遍历排序数组中的前keywordNum个元素，将其添加到摘要结果的关键词数组中
            for (var i = 0; i < keywordNum; i++) {
                summary.keywords.push(sortedWords[i][0]);
            }

            // 使用正则表达式匹配所有的句子
            var sentences = text.match(sentenceRegex);

            // 定义一个变量用于存储句子的得分阈值，根据总的单词数确定，最小为2，最大为5
            var threshold = Math.max(Math.min(Math.floor(totalWords / 100), 5), 2);

            // 遍历所有的句子
            for (var sentence of sentences) {
                // 定义一个变量用于存储句子的得分，初始为0
                var score = 0;

                // 使用正则表达式匹配句子中的所有单词
                var sentenceWords = sentence.match(wordRegex);

                // 遍历句子中的所有单词
                for (var sentenceWord of sentenceWords) {
                    // 将单词转换为小写
                    sentenceWord = sentenceWord.toLowerCase();

                    // 如果单词在摘要结果的关键词数组中，增加句子的得分
                    if (summary.keywords.includes(sentenceWord)) {
                        score++;
                    }
                }

                // 如果句子的得分大于或等于阈值，将句子添加到摘要结果的句子数组中
                if (score >= threshold) {
                    summary.sentences.push(sentence);
                }
            }

            // 返回摘要结果
            return summary;
        }

        // 定义一个函数用于显示摘要结果
        function showSummary(title, summary) {
            // 获取输出框的元素
            var output = document.getElementById("output");

            // 清空输出框的内容
            output.innerHTML = "";

            // 创建一个标题元素，设置其内容为标题参数
            var titleElement = document.createElement("h3");
            titleElement.innerText = title;

            // 创建一个关键词元素，设置其内容为关键词数组的字符串形式，用逗号分隔
            var keywordElement = document.createElement("p");
            keywordElement.innerText = "关键词 Keywords: " + summary.keywords.join(", ");

            // 创建一个句子元素，设置其内容为句子数组的字符串形式，用换行符分隔
            var sentenceElement = document.createElement("p");
            sentenceElement.innerText = "摘要 Summary: \n" + summary.sentences.join("\n");

            // 将标题元素，关键词元素和句子元素依次添加到输出框中
            output.appendChild(titleElement);
            output.appendChild(keywordElement);
            output.appendChild(sentenceElement);

            // 显示输出框
            output.hidden = false;
        }
    </script>
</body>
</html>
